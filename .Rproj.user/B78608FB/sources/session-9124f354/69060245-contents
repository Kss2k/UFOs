
# old
# Deprecated version of %pre%
#'
#' @param .data array like object, or list
#' @param prefix prefix to gather elements based upon
#'
#' @return
#' @export
#'
#' @examples
#'
'%#%' <- function(.data, prefix) {
  prefix <- as.character(substitute(prefix))
  .data[startsWith(colnames(.data), prefix)]
}

#' Select Variable by prefixoperator
#'
#' @param .data array-like object, or list
#' @param prefix prefix to find variables by
#'
#' @return
#' @export
#'
#' @examples
'%pre%' <- function(.data, prefix) {
  string.prefix <- substitute(prefix) |>
    as.character()
  .data[startsWith(names(.data), string.prefix)]
}

#' Select Variable by prefix
#'
#' @param .data array-like object, or list
#' @param prefix prefix to find variables by
#'
#' @return
#' @export
#'
#' @examples cars%pre%spe
prefix <- function(.data, prefix) {
  string.prefix <- substitute(prefix) |>
    as.character()
  .data[startsWith(names(.data), string.prefix)]
}

#' Title
#'
#' @param .data
#' @param prefix
#'
#' @return
#' @export
#'
#' @examples
antiPrefix <- function(.data, prefix) {
  string.prefix <- substitute(prefix) |>
    as.character()
  .data[!startsWith(names(.data), string.prefix)]
}

#' Title
#'
#' @param .data
#' @param prefix
#'
#' @return
#' @export
#'
#' @examples
'%!pre%' <- function(.data, prefix) {
  string.prefix <- substitute(prefix) |>
    as.character()
  .data[!startsWith(names(.data), string.prefix)]
}

#' Title
#'
#' @param .data
#' @param pattern
#'
#' @return
#' @export
#'
#' @examples
'%match%' <- function(.data, pattern) {
  names <- names(.data)
  string.pattern <- substitute(pattern) |>
    as.character()
  extractedNames <- grep(string.pattern, names, value = TRUE)
  .data[extractedNames]
}

#' Title
#'
#' @param .data
#' @param pattern
#'
#' @return
#' @export
#'
#' @examples
'%!match%' <- function(.data, pattern) {
  names <- names(.data)
  string.pattern <- substitute(pattern) |>
    as.character()
  extractedNames <- grep(string.pattern, names, value = TRUE)
  .data[!(names %in% extractedNames)]
}

#' Title
#'
#' @param .data
#' @param regex
#'
#' @return
#' @export
#'
#' @examples
'%rgx%' <- function(.data, regex) {
  # FUNCTIONS: regexpr and gregexpr
  names <- names(.data)
  .data[grep(regex,names, value = TRUE)]

}

#' Title
#'
#' @param .data
#' @param regex
#'
#' @return
#' @export
#'
#' @examples
'%!rgx%' <- function(.data, regex) {
  # FUNCTIONS: regexpr and gregexpr
  names <- names(.data)
  extractedNames <- grep(regex,names, value = TRUE)
  .data[!(names %in% extractedNames)]

}



#' Title
#'
#' @param .data
#' @param suffix
#'
#' @return
#' @export
#'
#' @examples
'%suf%' <- function(.data, suffix) {
  string.suffix <- substitute(suffix) |>
    as.character()
  .data[endsWith(names(.data), string.suffix)]
}

#' Title
#'
#' @param .data
#' @param suffix
#'
#' @return
#' @export
#'
#' @examples
'%!suf%' <- function(.data, suffix) {
  string.suffix <- substitute(suffix) |>
    as.character()
  .data[!endsWith(names(.data), string.suffix)]
}

#' Title
#'
#' @param .data
#' @param by.variable
#'
#' @return
#' @export
#'
#' @examples
'%by%' <- function(.data, by.variable) {
  # String with varname
  string.varname <- substitute(by.variable) |>
    as.character()

  # output: list with dataframes
  list.output <- list()

  # Unique vallues to split dataframe by
  unique.values <- unique(.data[string.varname]) |>
    unlist() |>
    as.vector()

  # Number of unique values
  n.values <- length(unique.values)


  for (i in 1:n.values){
    # Subsetting the dataset by ith unique value
    data.subset <- subset(.data, .data[string.varname] == unique.values[i])

    # name for split object
    name <- paste0(string.varname, " = ", unique.values[i])

    # adding subset to list
    list.output[[name]] <- data.subset
  }
  list.output
}

#' Title
#'
#' @param .data
#' @param prefix
#'
#' @return
#' @export
#'
#' @examples
'%byPre%' <- function(.data, prefix) {

  string.prefix <- substitute(prefix) |>
    as.character()
  var <- .data[startsWith(names(.data), string.prefix)][,1]

  # String with varname
  string.varname <- names(var)
  print(string.varname)
  # output: list with dataframes
  list.output <- list()

  # Unique vallues to split dataframe by
  unique.values <- unique(.data[string.varname]) |>
    unlist() |>
    as.vector()

  # Number of unique values
  n.values <- length(unique.values)


  for (i in 1:n.values){
    # Subsetting the dataset by ith unique value
    data.subset <- subset(.data, .data[string.varname] == unique.values[i])

    # name for split object
    name <- paste0(string.varname, " = ", unique.values[i])

    # adding subset to list
    list.output[[name]] <- data.subset
  }
  list.output
}
